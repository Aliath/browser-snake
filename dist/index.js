!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/dist",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{callSubscribers(){this.subscribers.forEach(t=>{t()})}set(t,e){this.data[t]=e,this.callSubscribers()}get(t){return this.data[t]}emitEvent(t,e){this.events.hasOwnProperty(t)&&this.events[t].forEach(t=>t(e))}on(t,e){this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e)}subscribe(t){this.subscribers.push(t)}constructor(){this.data={},this.events={},this.subscribers=[]}}var n=new i;var h=new i;class r{defineElements(){this.containerElement=document.getElementById("start-page"),this.startButton=document.getElementById("start-button")}handleElements(){this.startButton.addEventListener("click",()=>{n.set("PAGE_STATE","GAME_PAGE"),h.set("GAME_STATE","ON"),h.set("GAME_STARTTIME",Date.now())},!1)}hide(){this.containerElement.classList.add("article--hidden")}show(){this.containerElement.classList.remove("article--hidden")}constructor(){this.defineElements(),this.handleElements()}}class o{defineElements(){this.containerElement=document.getElementById("game-page")}hide(){this.containerElement.classList.add("article--hidden")}show(){this.containerElement.classList.remove("article--hidden")}constructor(){this.defineElements()}}class a{defineElements(){this.containerElement=document.getElementById("gameover-page"),this.resultElement=document.getElementById("gameover-result"),this.buttonElement=document.getElementById("gameover-button")}handleElements(){this.buttonElement.addEventListener("click",()=>{n.set("PAGE_STATE","GAME_PAGE"),h.set("GAME_STATE","ON"),h.set("GAME_STARTTIME",Date.now())},!1)}bindResultHandler(){n.subscribe(()=>{const t=h.get("GAME_RESULT");this.resultElement.textContent=t+" pkt"})}hide(){this.containerElement.classList.add("article--hidden")}show(){this.containerElement.classList.remove("article--hidden")}constructor(){this.defineElements(),this.handleElements(),this.bindResultHandler()}}const c="START_PAGE",d="GAME_PAGE",l="GAMEOVER_PAGE";class E{setCollision(t,e){this.collisions[e*this.width+t]=1}removeCollision(t,e){this.collisions[e*this.width+t]=0}checkCollision(t,e){return 1===this.collisions[e*this.width+t]}getCollisions(){return[...this.collisions]}setDefaultCols(){const t=this.collisions.map((t,e)=>{const s=e%this.width,i=(e-s)/this.width;return 0===s||0===i||s===this.width-1||i===this.height-1?1:0});this.collisions=t}setSize(t,e){this.width=t,this.height=e,this.collisions=new Array(this.width*this.height).fill(0)}constructor(){this.setSize.apply(this,h.get("GAME_SIZE")),this.setDefaultCols()}}class u{hasReachedPosition(t,e){return this.x===t&&0===this.y}getAvailablePositions(){const t=this.map.getCollisions().map(t=>1===t?0:1);return this.snake.getElements().forEach(e=>{const[s,i]=e;t[i*this.map.width+s]=0}),t.map((t,e)=>{const s=e%this.map.width;return[t,s,(e-s)/this.map.width]}).filter((t,e)=>1===t[0])}setNewPosition(){const t=this.getAvailablePositions(),e=t[Math.round(Math.random()*t.length)],[,s,i]=e;Object.assign(this,{x:s,y:i})}getPosition(){return[this.x,this.y]}constructor(t,e){this.map=t,this.snake=e,this.setNewPosition()}}const m=t=>{switch(t){case"UP":return[0,-1];case"LEFT":return[-1,0];case"RIGHT":return[1,0];case"DOWN":return[0,1]}};class g{setDirection(t){this.direction=t}updateGameSpeed(){const t=2/((Date.now()-h.get("GAME_STARTTIME"))/1e3/60+2)*250;h.set("GAME_SPEED",t)}move(){if(this.updateGameSpeed(),setTimeout(this.move.bind(this),h.get("GAME_SPEED")),"OFF"===h.get("GAME_STATE"))return;const t=m(this.direction);if(this.checkIsOnBody(t))return h.emitEvent("GAME_OVER");if(this.checkIsOnPoint(t))return void h.set("GAME_RESULT",h.get("GAME_RESULT")+1);const e=this.body[0].map((e,s)=>e+=t[s]),s=[...this.body].map(t=>[...t]);s.unshift(e),this.body=s.map((t,e,s)=>{if(0===e)return t;return[...s[e-1]]}),this.body.shift(),this.checkIsOnCollision(),this.checkHasEatenItself()}checkHasEatenItself(){if(1===this.body.length)return!1;const[t,e]=this.body[0];let s=!1;this.body.slice(1).forEach(i=>{const[n,h]=i;n===t&&h===e&&(s=!0)}),s&&h.emitEvent("GAME_OVER")}checkIsOnCollision(){const[t,e]=this.body[0];this.map.checkCollision(t,e)&&h.emitEvent("GAME_OVER")}checkIsOnPoint(t){const e=this.body[0],s=[e[0]+t[0],e[1]+t[1]],i=this.point.getPosition();return i[0]===s[0]&&i[1]===s[1]&&(this.body.unshift(s),this.point.setNewPosition(),!0)}checkIsOnBody(t){const e=this.body[0],s=[e[0]+t[0],e[1]+t[1]];return!!this.body.find(t=>{const[e,i]=t;return s[0]===e&&s[1]===i})}getElements(){return this.body.map(t=>[...t])}addElement(){const t=this.body[this.body.length-1],e=[...t],s=m(this.direction);e[0]+=s[0],e[1]+=s[1],this.body.push(t)}createBody(){const t=Math.round(this.map.width/2),e=Math.round(this.map.height/2);this.body.push([t,e])}reset(){this.body=[],this.createBody()}handleStore(){h.subscribe(()=>{this.direction=h.get("GAME_DIRECTION"),this.speed=h.get("GAME_SPEED")}),h.on("GAME_OVER",this.reset.bind(this))}constructor(t){this.map=t,this.direction="RIGHT",this.body=[],this.point=new u(t,this),this.createBody(),this.handleStore(),setTimeout(this.move.bind(this),h.get("GAME_SPEED"))}}var A=()=>{const t=Math.min(window.innerWidth,window.innerHeight)/20;return Math.round(Math.max(Math.min(t,32),10))};const b="#181818",T="#00b894",f="darkred",p="#a29bfe",w=A();class y{render(){if(!this.isRendering)return;requestAnimationFrame(this.render.bind(this));const t=this.canvasContext,e=this.snake.getElements(),s=this.map.collisions;t.fillStyle=b,t.fillRect(0,0,this.map.width*w,this.map.height*w),t.fillStyle=p;const i=this.snake.point.getPosition();t.fillRect(i[0]*w,i[1]*w,w,w),t.fillStyle=T,e.forEach(e=>{t.fillRect(e[0]*w,e[1]*w,w,w)}),t.fillStyle=f,s.map((t,e)=>{const s=e%this.map.width;return[t,s,(e-s)/this.map.width]}).filter(t=>1===t[0]).forEach((e,s)=>{const[,i,n]=e;t.fillRect(i*w,n*w,w,w)})}startRender(){this.isRendering||(this.isRendering=!0,requestAnimationFrame(this.render.bind(this)))}stopRender(){this.isRendering=!1}handleStore(){h.subscribe(()=>{"OFF"===h.get("GAME_STATE")?this.stopRender():this.startRender()})}constructor(t,e,s){Object.assign(this,{canvasContext:t,map:e,snake:s}),this.isRendering="ON"===h.get("GAME_STATE"),this.handleStore()}}const S={UP:["KeyW","ArrowUp"],LEFT:["KeyA","ArrowLeft"],RIGHT:["KeyD","ArrowRight"],DOWN:["KeyS","ArrowDown"]};class M{handleKeyEvents(){addEventListener("keydown",t=>{Object.keys(S).forEach(e=>{S[e].indexOf(t.code)>-1&&h.set("GAME_DIRECTION",e)})},!1)}constructor(){this.handleKeyEvents()}}class G{handleTouch(t,e){const s=Math.abs(t)-Math.abs(e);if(0===s)return;const i=s>0?"HORIZONTAL":"VERTICAL",n=[t,e].reduce((t,e)=>Math.abs(t)>Math.abs(e)?t:e)>0;let r;r="HORIZONTAL"===i?n>0?"RIGHT":"LEFT":n>0?"DOWN":"UP",h.set("GAME_DIRECTION",r)}handleTouchStart(){this.element.addEventListener("touchstart",t=>{this.startX=t.changedTouches[0].clientX,this.startY=t.changedTouches[0].clientY},!1)}handleTouchEnd(){this.element.addEventListener("touchend",t=>{const e=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY,i=e-this.startX,n=s-this.startY;this.handleTouch(i,n)},!1)}handleTouchEvents(){this.handleTouchStart(),this.handleTouchEnd()}constructor(t){this.element=t,this.startX=0,this.startY=0,this.handleTouchEvents()}}const P=A();new class{hideAllPages(){this.startPage.hide(),this.gamePage.hide(),this.gameOverPage.hide()}bindPageHandler(){n.subscribe(()=>{this.currentState=n.get("PAGE_STATE"),this.renderPage()})}createPages(){this.startPage=new r,this.gamePage=new o,this.gameOverPage=new a}renderPage(){switch(this.hideAllPages(),this.currentState){case c:this.startPage.show();break;case d:this.gamePage.show();break;case l:this.gameOverPage.show()}}setState(t){this.currentState=t,this.renderPage()}constructor(){this.bindPageHandler(),this.createPages(),n.set("PAGE_STATE","START_PAGE"),this.renderPage()}},new class{setCanvasSize(){this.width=Math.floor(window.innerWidth/P),this.height=Math.floor(window.innerHeight/P),this.canvas.width=this.width*P,this.canvas.height=this.height*P,h.set("GAME_SIZE",[this.width,this.height])}setDefaultStore(){h.set("GAME_STATE","OFF"),h.set("GAME_SIZE",[0,0]),h.set("GAME_DIRECTION","RIGHT"),h.set("GAME_SPEED",250),h.set("GAME_RESULT",0)}handleStore(){h.on("GAME_OVER",()=>{h.set("GAME_DIRECTION","RIGHT"),h.set("GAME_SPEED",250),h.set("GAME_STATE","OFF"),n.set("PAGE_STATE","GAMEOVER_PAGE")})}constructor(t){this.width=0,this.height=0,this.canvas=t,this.context=this.canvas.getContext("2d"),this.setDefaultStore(),this.setCanvasSize(),this.keyboardManager=new M,this.touchManager=new G(t),this.map=new E(this.width,this.height),this.snake=new g(this.map),this.renderer=new y(this.context,this.map,this.snake),this.handleStore()}}(document.getElementById("screen"))}]);